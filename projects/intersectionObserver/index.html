<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CDN -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital@0;1&display=swap" rel="stylesheet">
    <!-- Styles -->
    <link href="../../global/styles/css/global.css" rel="stylesheet">       
    <link href="../../global/styles/css/prism.css" rel="stylesheet">       
    <link href="intersection-observer.css" rel="stylesheet">   
    <!-- JS -->
    <script src="../../global/GlobalHeader.js" type="module"></script>
    <script src="../../global/js/prism.js" defer></script>       
    <script src="intersectionObserver.js" defer></script> 
    <title>
        Intersection Observer API || Martin Duggan, Product Designer
    </title>
</head>
<body class="fun__grid">
    <header class="fun__header">
        <fun-nav></fun-nav>
    </header>
    <main class="fun__main" role="main">
        <section class="project">
            <article class="content">
                <h2 class="title">Intersection Observer API</h2>
                <p>First play with Intersection Observer API. Scroll down to see, lazy-loads <a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API">MDN</a></p>
            </article>
            <ul class="product-list"> </ul>
        </section>
        <section class="fun__code-block">
            <pre class="language-js" rel="JS" >
                <code>
    const cards = document.querySelectorAll(".card");

    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                entry.target.classList.toggle("show", entry.isIntersecting);
                // add class when visibility true
                if (entry.isIntersecting) observer.unobserve(entry.target);
                // when loaded stop observing
            });
        }, // options:
        {
            threshold: 1, // 100% of element must be in viewport
        }
    );

    // dynamically add new cards after last visible one
    const lastCardObserver = new IntersectionObserver((entries) => {
        const lastCard = entries[0];
        if (!lastCard.isIntersecting) return;
        // only observe if last card is visible
        loadNewCards();
        lastCardObserver.unobserve(lastCard.target);
        lastCardObserver.observe(document.querySelector(".card:last-child"));
    }, {});

    lastCardObserver.observe(document.querySelector(".card:last-child"));

    cards.forEach((card) => {
        observer.observe(card);
    });

    // function to dynamically create new cards

                </code>
            </pre>
        </section>
    </main>
</body>
</html>